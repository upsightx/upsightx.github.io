---
name: idle-trigger
description: 智能空闲触发器。当用户超过指定时间没有交互、系统空闲、且没有正在执行的任务时，自动触发思考和行动。使用场景：(1) 用户想让我在空闲时自动找事做，(2) 用户希望后台任务能被自动执行，(3) 用户想让我主动推进未完成的工作，(4) 定期搜索最新 AI 信息并学习。触发条件：用户10分钟无回复 + 系统10分钟空闲 + 无正在执行的任务。
---

# 智能空闲触发器

## 工作原理

在每次心跳时检查三个条件：
1. **用户静默时间** - 从上次用户消息到现在超过 N 分钟
2. **系统空闲时间** - 键盘/鼠标无操作超过 N 分钟
3. **无活动任务** - 当前没有正在执行的命令或子代理

当三个条件都满足时，进入"主动模式"：
- 检查 HEARTBEAT.md 中的待办任务
- 检查 MEMORY.md 中的未完成事项
- 检查 workspace 中的项目状态
- **检查是否需要搜索 AI 信息（每小时一次）**
- 选择一个有价值的任务执行

## 定期 AI 信息搜索

每隔 1 小时自动搜索最新 AI 相关信息：

### 搜索主题
1. **Claude/Anthropic** - 新模型、新功能、API 更新
2. **OpenAI/GPT** - GPT-5、o3、新能力
3. **Google Gemini** - 新版本、新功能
4. **MCP 协议** - 工具集成标准进展
5. **AI Agent 框架** - 自主代理、工具使用
6. **开源模型** - LLaMA、Qwen、Mistral 等

### 搜索流程
```bash
# 检查上次搜索时间
lastAISearch in idle-state.json

# 如果超过 1 小时，执行搜索
web_search("Claude Opus 4.6 new features 2026")
web_search("OpenAI GPT-5 o3 release 2026")
web_search("AI agent MCP tools latest 2026")
```

### 处理搜索结果
1. 提取重要信息
2. 更新 MEMORY.md 中的 AI 技术笔记
3. 如有重大发现，通知用户
4. **思考如何应用到 OpenClaw 改进**
5. **自动执行可行的改进**

## 自动改进 OpenClaw

根据搜索到的 AI 新技术，思考并执行改进：

### 改进方向

1. **模型优化**
   - 发现更好的模型 → 建议切换
   - 新的推理模式 → 更新配置

2. **工具集成**
   - 新的 MCP 工具 → 安装配置
   - 新的 API → 添加支持

3. **工作流优化**
   - 更好的提示技术 → 更新 SOUL.md
   - 新的 Agent 模式 → 优化 AGENTS.md

4. **技能扩展**
   - 发现有用的能力 → 创建新技能
   - 现有技能改进 → 更新 SKILL.md

### 自动执行规则

**可直接执行：**
- 更新配置文件（非破坏性）
- 创建/更新技能
- 优化文档
- 安装新工具

**需用户确认：**
- 切换主模型
- 修改认证配置
- 删除现有功能

### 改进执行流程

```
1. 搜索 AI 信息
2. 分析可应用到 OpenClaw 的点
3. 制定改进计划
4. 执行安全的改进
5. 记录到 MEMORY.md
6. 如有重要改进，通知用户
```

## 配置

在 HEARTBEAT.md 中设置参数：

```markdown
# 空闲触发配置
IDLE_TRIGGER_MINUTES=10
LAST_USER_MESSAGE_TIME=1707580000
```

## 检测脚本

运行空闲检测：
```bash
./scripts/check_idle.sh
```

返回值：系统空闲秒数

## 心跳行为

### 条件检查

```bash
# 获取系统空闲时间
IDLE_SECS=$(./scripts/check_idle.sh)
IDLE_MINS=$((IDLE_SECS / 60))

# 获取用户静默时间（从状态文件读取）
USER_SILENT_MINS=$(( (当前时间 - LAST_USER_MESSAGE_TIME) / 60 ))

# 检查是否有活动任务
# 通过检查 sessions_list 或正在运行的进程
```

### 触发行动

当 `IDLE_MINS >= 10` 且 `USER_SILENT_MINS >= 10` 且无活动任务时：

1. **读取任务列表**
   - HEARTBEAT.md 中的待办
   - MEMORY.md 中的未完成事项
   - workspace 中的 TODO/FIXME 注释

2. **选择任务优先级**
   - 高优先级：用户明确要求的任务
   - 中优先级：项目维护任务（文档更新、代码整理）
   - 低优先级：学习探索任务

3. **执行并汇报**
   - 执行选定的任务
   - 在 MEMORY.md 中记录进度
   - 如有重要发现，通过消息通知用户

## 示例行动

### 可自动执行的任务

- 整理 workspace 文件
- 更新文档中的过时信息
- 检查服务器健康状况
- 提交未推送的 git 更改
- 清理临时文件
- 更新记忆文件
- 检查并修复配置问题

### 需要确认的任务

- 发送外部消息/邮件
- 修改重要配置
- 执行不可逆操作
- 访问敏感数据

## 状态文件

维护空闲触发状态：
```
/root/.openclaw/workspace/memory/idle-state.json
```

```json
{
  "lastUserMessage": "2026-02-10T12:00:00Z",
  "lastTrigger": "2026-02-10T12:30:00Z",
  "pendingTasks": [
    {"task": "更新 JARVIS 框架", "priority": "high"},
    {"task": "整理记忆文件", "priority": "medium"}
  ]
}
```

## 注意事项

- **不要过度触发** - 执行完一个任务后，至少等待30分钟再触发下一个
- **保持安静** - 在深夜时段（23:00-08:00）减少主动行为
- **尊重用户** - 如果用户说"别打扰我"，暂停主动行为
- **安全第一** - 只执行安全的、可逆的操作
